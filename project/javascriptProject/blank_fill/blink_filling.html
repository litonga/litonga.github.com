<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>选词填空</title>
    <link href="main.css"rel="stylesheet"/>
</head>
<body>
<div class="container">
    <div class="content">
        <div class="top">
            <button class="submit">提交</button>
        </div>
        <div  class="articalContainer">
            <h4> 点击空格处，选择最恰当的单词</h4>
            <p  class="artical"></p>
        </div>
        <div class="dragBtn">
        </div>
    </div>
    <!--数字索引和选项-->
    <div id="bottom">
        <ul class="numbers"> </ul>
        <ul class="options"> </ul>
    </div>
</div>
<!--成绩报告-->
<div class="finally">
    <div class="message">
        <h1>成绩报告</h1>
        <div class="result">
           
        </div>
<!--     <button id="findExplan">查解析</button> -->
    <button id="toBack">回列表</button>
    </div>
</div>
<script type="text/javascript">
    /*
    * 调试函数：* * */
    var artical = "It's the first question parents ask when their child is diagnosed with autism (自闭症). Will his future brothers or sisters have a higher risk of 1 _____ it, too? According to the largest study of siblings (兄弟姐妹) in families with autism, the answer is yes. Among 664 children who had at least one older sibling with the developmental disorder, the 2 _____ risk of autism was nearly 19%, 3 _____ higher than previous sibling-recurrence estimates that were anywhere from 3% to 10%. Kids with more than one older autistic sibling had an even higher risk of the disorder: 32%. The 4 _____ suggest that genes play a key role in autism risk. But they also hint that other environmental factors 5 _____ by siblings, like influences in the womb (子宫), may be important as well. On the 6 _____ of the findings, the researchers recommend that doctors closely 7 _____ younger siblings of autistic children to pick up any early signs of the disorder, 8 _____ an unusually large head or delayed language development and communication skills. Evidence suggests that early 9_____ and diagnosis of autism can help children take advantage of therapies that can treat some of its 10_____";
     var optionsWord='["common","results","consequently","basis","detection","monitor","symbols","average","dramatically","symptoms","reason","distributed","including","developing","shared"]';
     var rightOptions = {1:'developing',2:'average',3:'dramatically',4:'results',5:'shared',6:'basis',7:'monitor',8:'including',9:'detection',10:'symptoms'};
     var answerObj = {};



    var articalDiv = document.getElementsByClassName('artical')[0];
    //找到填空位置，替换为span


    /* 中间数字导航按钮-------------begin------------------*/
    var pattern = /(_)+/g;
    var blankCount = artical.match(pattern).length; //获取空格的个数
    var  numbers= document.getElementsByClassName("numbers")[0];
    for(var i=0;i<blankCount;i++){  //创建并添加数字索引 numbers
        var number = document.createElement('li');
        var span = document.createElement('span');
        span.innerHTML = i+1;
        number.appendChild(span);
        number.onclick=movePoint;
        number.className='number';
        number.setAttribute('data-num',i+1);
        //console.log( number.innerHTML);
        numbers.appendChild(number);
    }
    numbers.style.width=(blankCount*(27+5))+"px";
    /* 中间数字导航按钮-------------end------------------*/


    /* 空格替换为span----------------begin-----------------*/
    articalDiv.innerHTML = artical.replace(pattern,"<span onclick='handleBlank(this);' data-num='+i+' class='wordBlank'></span>");
    var wordBlank = document.getElementsByClassName('wordBlank');
    for(var i= 0,len=wordBlank.length;i<len;i++){
        wordBlank[i].setAttribute('data-num',i+1);
    }
    /* 空格替换为span----------------end-----------------*/



    //一个临时json文件，由服务端传入
   
    //var optionsWord2="['common','results','consequently','basis','detection','monitor','symbols','average','dramatically','symptoms','reason','distributed','including','developing','shared']";
    var json = JSON.parse(optionsWord);
    //导入选项
    var options = document.getElementsByClassName('options')[0];
    for(var i= 0,len=json.length;i<len;i++){
        var li = document.createElement('li');
        li.className="wordOption";//单词选项;
        li.innerHTML=json[i];
        options.appendChild(li);
    }

    //点击空格，激活选项，
    function handleBlank(et){
        var  wordOption = document.getElementsByClassName('wordOption');
        console.log('点击空格');
        console.log('激活选项个数：'+wordOption.length);
        for(var i=0;i < wordOption.length;i++){ //激活，替换为链接
            addClass(wordOption[i],'active');//激活
            wordOption[i].onclick = fillAnswer;//点击填充答案;
            wordOption[i].onmouseover = fillAnswering;//点击填充答案;
        }
        //其他空格移除 blue  begin
        var wordBlank = document.getElementsByClassName('wordBlank');
        for(var i= 0,len=wordBlank.length;i<len;i++){
            removeClass(wordBlank[i],'blue');
        }
        //其他空格移除 blue  end
        addClass(et,'blue');
        //导航箭头显示
        var navNumber = document.getElementsByClassName('number');
        for(var i= 0,len=navNumber.length; i<len; i++){
            if(navNumber[i].getAttribute('data-num') === et.getAttribute('data-num')){
                addClass(navNumber[i],'havePoint');
            }else{
                removeClass(navNumber[i],'havePoint');
            }
        }
    }

    //鼠标悬停答案，显示在空格上；
    function  fillAnswering(e){
        var activeBlank = document.getElementsByClassName('blue')[0];
        if(activeBlank){
            activeBlank.innerHTML = e.target.innerHTML;//
            activeBlank.style.color='white';
        }
    }

    //填充答案begin
    function  fillAnswer(e){//点击单词填充答案; e.target代表单词
        //找到填空空位置
        var activeBlank = document.getElementsByClassName('blue')[0];
        activeBlank.innerHTML = e.target.innerHTML;//填写
        activeBlank.style.color='#38D2EA';

        //答案存入对象中
        console.log(activeBlank.getAttribute('data-num'));
        var i = activeBlank.getAttribute('data-num');
        answerObj[i]=e.target.innerHTML;


        removeClass(activeBlank,'blue');   //移除空格激活状态；
        e.target.style.textDecoration='line-through';

        ////移除单词选项激活状态begin
        var  wordOption = document.getElementsByClassName('wordOption');
        console.log("填写答案，取消选项激活");
        for(var i= 0,len=wordOption.length;i<len;i++){
            wordOption[i].setAttribute('onclick','');
            removeClass(wordOption[i],'active');
        }
        //移除单词选项激活状态end
        //数字导航变蓝色
        var havePoint = document.getElementsByClassName('havePoint')[0];
        havePoint.childNodes[0].style.backgroundColor='#6FD3F1';

        //去掉三角箭头
        var navNumber = document.getElementsByClassName('number');
        for(var i= 0,len=navNumber.length; i<len; i++){
                removeClass(navNumber[i],'havePoint');
        }
    }
    //点击导航数字移动箭头，并显示空栏
    function movePoint(ent){
        ent.stopPropagation();  //阻止冒泡
        console.log(ent.target.parentNode);
        var navNumbers = document.getElementsByClassName('number');
        for(var i= 0,len=navNumbers.length; i<len; i++){
            
                console.log('移除其他导航箭头')
                removeClass(navNumbers[i],'havePoint');//移除其他导航箭头
        }
        addClass(ent.target.parentNode,'havePoint'); //为li添加havePoint类


         var wordBlanks = document.getElementsByClassName('wordBlank');
         for(var i= 0,len=wordBlanks.length; i<len; i++){
            if(wordBlanks[i].getAttribute('data-num') === ent.target.parentNode.getAttribute('data-num')){
                //滚动到视口
                wordBlanks[i].scrollIntoView();
                //激活该空格
                handleBlank(wordBlanks[i]);

            }else{
                removeClass(wordBlanks[i],'blue');
            }
        }
    }
    //填充答案end


    function hasClass(element, className) {
        return element.className.match(new RegExp('(\\s|^)'+className+'(\\s|$)'));
    }
    //添加一个class，如果不存在的话
    function addClass(element, className) {
        if (!hasClass(element, className)) {
            element.className += " "+className;
        }
    }
    //删除一个class，如果存在的话
    function removeClass(element, className) {
        if (hasClass(element, className)) {
            element.className = element.className.replace(
                    new RegExp('(\\s|^)'+className+'(\\s|$)'),' ');
        }
    }


    /**提交后检查**/
    var submit1 = document.getElementsByClassName('submit')[0];
    submit1.onclick = function(){
        var finallyPage = document.getElementsByClassName('finally')[0];
        finallyPage.style.display='block';
        result =document.getElementsByClassName('result')[0];

        //有可能第二次看答案，此时不需要再添加span结点，所以做一个判断
        var answers =  document.getElementsByClassName('answer');
        if(answers.length !== 10){
            for(var i in rightOptions){
            var span = document.createElement('span');
            addClass(span,'answer');
            span.innerHTML=i;
            result.appendChild(span);
            }
        }else{

        }


        var answers =  document.getElementsByClassName('answer');
        for(var i in rightOptions){
            removeClass(answers[i-1],'right');
            removeClass(answers[i-1],'false');
            if(answerObj[i]===rightOptions[i]) {
                addClass(answers[i-1],'right');
            }else{
                addClass(answers[i-1],'false');
            }
        }
    };

    var findExplan=document.getElementById('findExplan');
    var toBack=document.getElementById('toBack');
    toBack.onclick=function(){
    var finallyPage = document.getElementsByClassName('finally')[0];
        finallyPage.style.display='none';
    };
	
</script>
</body>
</html>